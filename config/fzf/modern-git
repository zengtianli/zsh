### MODERN GIT TOOLS
# ç°ä»£åŒ–Gitå·¥å…·é›†æˆ
# ç»“åˆ delta, lazygit å’Œ fzf æä¾›å¢å¼ºçš„Gitä½“éªŒ

# æ£€æŸ¥æ˜¯å¦åœ¨Gitä»“åº“ä¸­
if ! git rev-parse --git-dir > /dev/null 2>&1; then
  echo "âŒ å½“å‰ç›®å½•ä¸æ˜¯Gitä»“åº“"
  return 1
fi

# Gitæ“ä½œèœå•
local git_action=$(echo "ğŸ“Š æŸ¥çœ‹çŠ¶æ€ (git status)
ğŸ“ˆ æŸ¥çœ‹æäº¤å†å² (git log --oneline)
ğŸ” æŸ¥çœ‹å·®å¼‚ (git diff)
ğŸŒ¿ åˆ‡æ¢åˆ†æ”¯ (git checkout)
ğŸ“ äº¤äº’å¼æäº¤ (lazygit)
ğŸ”„ åŒæ­¥è¿œç¨‹ (git pull)
ğŸ“¤ æ¨é€æ›´æ”¹ (git push)
ğŸ·ï¸  æŸ¥çœ‹æ ‡ç­¾ (git tag)
ğŸ“ æŸ¥çœ‹æ–‡ä»¶å†å²
ğŸ”§ Gité…ç½®" | fzf --header='[ğŸ™ Gitå·¥å…·ç®±]' --height=60%)

case $git_action in
  *"æŸ¥çœ‹çŠ¶æ€"*)
    git status
    ;;
  *"æŸ¥çœ‹æäº¤å†å²"*)
    if command -v delta &> /dev/null; then
      git log --oneline --graph --decorate --all | fzf --preview 'git show --color=always {1}' --preview-window=right:60%
    else
      git log --oneline --graph --decorate --all | fzf --preview 'git show {1}' --preview-window=right:60%
    fi
    ;;
  *"æŸ¥çœ‹å·®å¼‚"*)
    if command -v delta &> /dev/null; then
      git diff --color=always | delta
    else
      git diff
    fi
    ;;
  *"åˆ‡æ¢åˆ†æ”¯"*)
    local branch=$(git branch -a | grep -v '^*' | fzf --header='[ğŸŒ¿ é€‰æ‹©åˆ†æ”¯]' | sed 's/^[ *]*//' | sed 's/remotes\/origin\///')
    if [[ -n "$branch" ]]; then
      git checkout "$branch"
    fi
    ;;
  *"äº¤äº’å¼æäº¤"*)
    if command -v lazygit &> /dev/null; then
      lazygit
    else
      echo "âŒ éœ€è¦å®‰è£… lazygit: brew install lazygit"
    fi
    ;;
  *"åŒæ­¥è¿œç¨‹"*)
    git pull
    ;;
  *"æ¨é€æ›´æ”¹"*)
    git push
    ;;
  *"æŸ¥çœ‹æ ‡ç­¾"*)
    git tag | fzf --preview 'git show --color=always {}' --preview-window=right:60%
    ;;
  *"æŸ¥çœ‹æ–‡ä»¶å†å²"*)
    local file=$(git ls-files | fzf --header='[ğŸ“ é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹å†å²]')
    if [[ -n "$file" ]]; then
      git log --oneline "$file" | fzf --preview "git show --color=always {1} -- $file" --preview-window=right:60%
    fi
    ;;
  *"Gité…ç½®"*)
    echo "ğŸ”§ Gité…ç½®é€‰é¡¹:"
    echo "1. é…ç½®ç”¨æˆ·ä¿¡æ¯"
    echo "2. è®¾ç½®Deltaä¸ºé»˜è®¤diffå·¥å…·"
    echo "3. æŸ¥çœ‹å½“å‰é…ç½®"
    echo -n "é€‰æ‹©æ“ä½œ [1-3]: "
    read -r choice
    case $choice in
      1)
        echo -n "è¾“å…¥ç”¨æˆ·å: "; read -r username
        echo -n "è¾“å…¥é‚®ç®±: "; read -r email
        git config --global user.name "$username"
        git config --global user.email "$email"
        echo "âœ… ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°"
        ;;
      2)
        if command -v delta &> /dev/null; then
          git config --global core.pager "delta"
          git config --global interactive.diffFilter "delta --color-only"
          git config --global delta.navigate true
          git config --global delta.side-by-side false
          echo "âœ… Deltaå·²è®¾ç½®ä¸ºé»˜è®¤diffå·¥å…·"
        else
          echo "âŒ éœ€è¦å®‰è£… delta: brew install git-delta"
        fi
        ;;
      3)
        git config --list | fzf --header='[âš™ï¸ Gité…ç½®]'
        ;;
    esac
    ;;
esac 